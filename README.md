# NTT-RVV-CHES2025
NTT vectorization for RISC-V Vector (RVV) - CHES2025

# Cloning
It is recommended that the project is clones with the `--recurse-submodules` option, to fetch OpenFHE as well. Otherwise, it will be necessary to `init` and `update` the submodules.

# Patching OpenFHE
After the OpenFHE submodule has been initialized, it must be patched to include the required changes. To do so, simply run the `patch-openfhe.sh` script from this repository's root directory.

# RISC-V Vector Compiler
The provided code makes use of the [EPI Vector Intrinsics](https://admin.hca.bsc.es/epi/ftp/doc/intrinsics/EPI/epi-intrinsics.html), and therefore requires an RVV 1.0 EPI LLVM compiler toolchain. The easiest way to obtain this is to run the `download-toolchain.sh` script from the repository's root, which will download a version of the EPI cross-compilation toolchain that is compatible with gem5.

To set the environment variables `CC/CXX` with the appropriate cross-compilers, simply run `source set-compilers.sh`.

### Other compilers
Other compiler toolchains can be obtained at (BSC's FTP server)[https://ssh.hca.bsc.es/epi/ftp/]. For compiling natively (on a RISC-V machine), look for a `llvm-EPI-development-toolchain-native` toolchain.

# Compilation
To compile the vectorized NTT/INTT implementations, `cd` into `ntt/`, and run `make`. This will create `ntt/bin/ntt-rvv.o`, which will need to be linked with any binaries that make use of OpenFHE. It will also statically compile a simple speedup test binary, `ntt/bin/test`.

OpenFHE is compiled normally, after patching and sourcing the `set-compilers.sh` script.

`example-ofhe-app` contains an application compiled with OpenFHE and the custom RVV code, and shows how to link the `ntt-rvv.o` object. If you wish to simulate it with gem5, you will want to compile the static OpenFHE libraries, as well as compile this application statically.

# Simulation
You may use gem5 to simulate the basic test `ntt/bin/test` or the `neural-net` app generated by `example-ofhe-app`. You can use the provided gem5 model: `gem5.opt gem5-model/main.py <static_executable>`.